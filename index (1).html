<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gold Pro Ultra | ØªØ­Ù„ÛŒÙ„Ú¯Ø± Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø·Ù„Ø§</title>
    
    <!-- Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>

    <!-- ØªÙ†Ø¸ÛŒÙ…Ø§Øª ÙˆØ¨â€ŒØ§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† (PWA) -->
    <link rel="manifest" href="data:application/manifest+json;base64,ewogICAgIm5hbWUiOiAiR29sZCBQcm8gUlRSIiwKICAgICJzaG9ydF9uYW1lIjogIkdvbGRQcm8iLAogICAgInN0YXJ0X3VybCI6ICIuIiwKICAgICJkaXNwbGF5IjogInN0YW5kYWxvbmUiLAogICAgImJhY2tncm91bmRfY29sb3IiOiAiIzAwMDAwMCIsCiAgICAidGhlbWVfY29sb3IiOiAiI0ZGRDcwMCIKfQ==">
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;700;900&display=swap');
        
        body { font-family: 'Vazirmatn', sans-serif; -webkit-tap-highlight-color: transparent; background-color: #050505; color: #e5e5e5; }
        
        /* Ø§ÙÚ©Øªâ€ŒÙ‡Ø§ÛŒ Ù†Ø¦ÙˆÙ†ÛŒ Ùˆ Ø·Ù„Ø§ÛŒÛŒ */
        .text-gold { color: #FFD700; text-shadow: 0 0 20px rgba(255, 215, 0, 0.5); }
        .border-gold { border-color: rgba(255, 215, 0, 0.3); }
        .bg-glass { background: rgba(30, 30, 30, 0.6); backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px); }
        
        .pulse-slow { animation: pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .7; } }

        /* Ù„ÙˆØ¯ÛŒÙ†Ú¯ */
        .loader { border: 3px solid #333; border-top: 3px solid #FFD700; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="pb-24">

    <!-- Ù‡Ø¯Ø± -->
    <nav class="sticky top-0 z-50 bg-black/80 backdrop-blur border-b border-gray-800 px-5 py-4 flex justify-between items-center">
        <div class="flex items-center gap-2">
            <i class="fas fa-coins text-yellow-500 text-2xl animate-pulse"></i>
            <div>
                <h1 class="font-black text-xl tracking-wide leading-none">Gold<span class="text-yellow-500">Pro</span></h1>
                <span class="text-[10px] text-gray-500 tracking-widest">ULTRA EDITION</span>
            </div>
        </div>
        <div class="flex items-center gap-2">
            <span class="w-2 h-2 rounded-full bg-green-500 animate-ping"></span>
            <span class="text-xs text-green-400 font-bold">LIVE</span>
        </div>
    </nav>

    <main class="p-4 max-w-xl mx-auto space-y-6">

        <!-- Ú©Ø§Ø±Øª Ù‚ÛŒÙ…Øª Ø§ØµÙ„ÛŒ -->
        <div class="relative overflow-hidden rounded-3xl bg-gradient-to-b from-gray-900 to-black border border-gray-800 p-8 text-center shadow-2xl">
            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-yellow-500 to-transparent"></div>
            <div class="absolute -top-10 -right-10 w-32 h-32 bg-yellow-500/10 rounded-full blur-3xl"></div>
            
            <p class="text-gray-400 text-xs font-bold uppercase tracking-widest mb-2">Ø·Ù„Ø§ÛŒ Û±Û¸ Ø¹ÛŒØ§Ø± / Ú¯Ø±Ù…</p>
            <div id="priceDisplay" class="text-5xl font-black text-gold font-[sans-serif] tracking-tight my-4">---</div>
            
            <div class="flex justify-center items-center gap-4">
                <div id="priceChange" class="px-3 py-1 rounded-lg bg-gray-800 text-sm font-bold border border-gray-700">--%</div>
                <div class="text-[11px] text-gray-500 flex items-center gap-1">
                    <i class="fas fa-clock"></i> <span id="lastUpdate">--:--</span>
                </div>
            </div>
        </div>

        <!-- Ù†Ù…ÙˆØ¯Ø§Ø± -->
        <div class="bg-glass rounded-2xl p-4 border border-gray-800 shadow-lg">
            <div class="flex justify-between items-center mb-4 px-2">
                <h3 class="font-bold text-gray-300 text-sm"><i class="fas fa-chart-area text-yellow-600 ml-2"></i>Ù†Ù…ÙˆØ¯Ø§Ø± ØªÚ©Ù†ÛŒÚ©Ø§Ù„</h3>
                <div class="flex gap-2">
                    <button class="text-[10px] bg-yellow-600/20 text-yellow-500 px-2 py-1 rounded hover:bg-yellow-600/40 transition">1H</button>
                    <button class="text-[10px] bg-gray-800 text-gray-400 px-2 py-1 rounded">24H</button>
                </div>
            </div>
            <div class="h-[220px] w-full">
                <canvas id="goldChart"></canvas>
            </div>
        </div>

        <!-- ØªØ­Ù„ÛŒÙ„Ú¯Ø± Ù‡ÙˆØ´Ù…Ù†Ø¯ (Gemini AI) -->
        <div class="bg-gray-900 rounded-2xl p-1 border border-purple-900/50 shadow-lg relative overflow-hidden group">
            <div class="absolute inset-0 bg-gradient-to-r from-purple-900/10 to-blue-900/10 opacity-50"></div>
            
            <div class="relative bg-black/40 backdrop-blur p-5 rounded-xl">
                <div class="flex justify-between items-start mb-3">
                    <div class="flex items-center gap-2">
                        <div class="w-8 h-8 rounded-full bg-gradient-to-tr from-purple-600 to-blue-600 flex items-center justify-center shadow-lg shadow-purple-900/50">
                            <i class="fas fa-robot text-white text-xs"></i>
                        </div>
                        <div>
                            <h3 class="font-bold text-sm text-gray-200">ØªØ­Ù„ÛŒÙ„Ú¯Ø± Ù‡ÙˆØ´Ù…Ù†Ø¯ AI</h3>
                            <p class="text-[10px] text-purple-400">Powered by Google Gemini</p>
                        </div>
                    </div>
                    <span id="aiSignalBadge" class="text-[10px] font-bold px-2 py-1 rounded bg-gray-800 text-gray-500 border border-gray-700">Ø¢Ù…Ø§Ø¯Ù‡</span>
                </div>

                <div class="space-y-3">
                    <p id="aiReasoning" class="text-xs text-gray-300 leading-6 text-justify border-r-2 border-purple-600 pr-3 min-h-[60px]">
                        Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¯Ø± Ø­Ø§Ù„ Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ Ø§Ø³Øª. Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ Ù†Ø¸Ø± Ø®ÙˆØ¯ Ø±Ø§ Ø§Ø¹Ù„Ø§Ù… Ù…ÛŒâ€ŒÚ©Ù†Ø¯...
                    </p>
                    
                    <!-- Ø¯Ú©Ù…Ù‡ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¯Ø³ØªÛŒ -->
                    <button onclick="runGeminiAI(true)" class="w-full py-2 rounded-lg bg-purple-600/20 hover:bg-purple-600/30 text-purple-300 text-xs border border-purple-600/30 transition flex items-center justify-center gap-2">
                        <i class="fas fa-sync-alt"></i> ØªØ­Ù„ÛŒÙ„ Ù…Ø¬Ø¯Ø¯ Ø¨Ø§Ø²Ø§Ø±
                    </button>
                </div>
            </div>
        </div>

        <!-- Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø³ÙˆØ¯ Ùˆ Ø²ÛŒØ§Ù† (Portfolio) -->
        <div class="bg-glass rounded-2xl p-5 border border-gray-800">
            <h3 class="font-bold text-gray-300 text-sm mb-4 flex items-center"><i class="fas fa-wallet text-green-500 ml-2"></i>Ø¯Ø§Ø±Ø§ÛŒÛŒ Ù…Ù† (Ù¾Ø±ØªÙÙˆÛŒ)</h3>
            
            <div class="grid grid-cols-2 gap-3 mb-4">
                <div>
                    <label class="text-[10px] text-gray-500 mb-1 block">Ù…Ù‚Ø¯Ø§Ø± Ø·Ù„Ø§ (Ú¯Ø±Ù…)</label>
                    <input type="number" id="pfWeight" class="w-full bg-black border border-gray-700 rounded p-2 text-white text-center text-sm focus:border-yellow-500 outline-none" placeholder="Ù…Ø«Ù„Ø§ 10">
                </div>
                <div>
                    <label class="text-[10px] text-gray-500 mb-1 block">Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø®Ø±ÛŒØ¯ (ØªÙˆÙ…Ø§Ù†)</label>
                    <input type="number" id="pfBuyPrice" class="w-full bg-black border border-gray-700 rounded p-2 text-white text-center text-sm focus:border-yellow-500 outline-none" placeholder="Ù…Ø«Ù„Ø§ 4200000">
                </div>
            </div>
            
            <div class="bg-gray-800/50 rounded-lg p-3 flex justify-between items-center">
                <span class="text-xs text-gray-400">Ø³ÙˆØ¯/Ø²ÛŒØ§Ù† Ø´Ù…Ø§:</span>
                <span id="pfProfit" class="text-sm font-bold text-gray-500">---</span>
            </div>
        </div>

        <!-- ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù‡Ø´Ø¯Ø§Ø± -->
        <div class="bg-glass rounded-2xl p-5 border border-gray-800">
            <h3 class="font-bold text-yellow-600 text-sm mb-4"><i class="fas fa-bell ml-2"></i>ØªÙ†Ø¸ÛŒÙ… Ù‡Ø´Ø¯Ø§Ø±</h3>
            
            <div class="flex gap-3 mb-4">
                <input type="number" id="alertHigh" class="flex-1 bg-black border border-gray-700 rounded p-2 text-white text-center text-xs focus:border-red-500 outline-none" placeholder="Ø­Ø¯ Ø¨Ø§Ù„Ø§">
                <input type="number" id="alertLow" class="flex-1 bg-black border border-gray-700 rounded p-2 text-white text-center text-xs focus:border-green-500 outline-none" placeholder="Ø­Ø¯ Ù¾Ø§ÛŒÛŒÙ†">
            </div>

            <div class="flex justify-between items-center bg-black/40 p-3 rounded-lg border border-gray-700">
                <div class="flex items-center gap-2">
                    <i class="fab fa-telegram text-blue-400"></i>
                    <span class="text-xs text-gray-300">Ø±Ø¨Ø§Øª ØªÙ„Ú¯Ø±Ø§Ù…</span>
                </div>
                <input type="checkbox" id="tgToggle" class="accent-blue-500 w-4 h-4 cursor-pointer">
            </div>
        </div>

    </main>

    <!-- Ø¬Ø§ÙˆØ§ Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ø§ØµÙ„ÛŒ -->
    <script>
        // ==========================================
        // âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§ØµÙ„ÛŒ (Config)
        // ==========================================
        const CONFIG = {
            // ØªÙˆÚ©Ù†â€ŒÙ‡Ø§ÛŒ Ø´Ù…Ø§
            GEMINI_KEY: 'AIzaSyC_aDub35N6gSkAgx5wSuPI0FDeBbHmI9U',
            TELEGRAM_TOKEN: '8427937062:AAGYnoVu_hEuanfGOM_EeMyX0aHBlsCBgYo',
            CHAT_ID: '474098524',
            
            // ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø±Ù†Ø§Ù…Ù‡
            BASE_PRICE: 4350000, // Ù‚ÛŒÙ…Øª Ù¾Ø§ÛŒÙ‡ Ø§Ú¯Ø± Ø§ÛŒÙ†ØªØ±Ù†Øª Ù†Ø¨ÙˆØ¯
            REFRESH_RATE: 10000, // Ù‡Ø± Û±Û° Ø«Ø§Ù†ÛŒÙ‡ Ø¢Ù¾Ø¯ÛŒØª Ù‚ÛŒÙ…Øª
            AI_INTERVAL: 120000 // Ù‡Ø± Û² Ø¯Ù‚ÛŒÙ‚Ù‡ ØªØ­Ù„ÛŒÙ„ Ø®ÙˆØ¯Ú©Ø§Ø±
        };

        // Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ ÙˆØ¶Ø¹ÛŒØª (State)
        let state = {
            price: CONFIG.BASE_PRICE,
            history: [],
            lastAlert: 0,
            chart: null,
            isThinking: false
        };

        const UI = {
            price: document.getElementById('priceDisplay'),
            change: document.getElementById('priceChange'),
            update: document.getElementById('lastUpdate'),
            aiBadge: document.getElementById('aiSignalBadge'),
            aiText: document.getElementById('aiReasoning'),
            profit: document.getElementById('pfProfit')
        };

        // ==========================================
        // ğŸš€ Ø´Ø±ÙˆØ¹ Ø¨Ø±Ù†Ø§Ù…Ù‡
        // ==========================================
        window.onload = () => {
            initChart();
            loadSettings();
            fetchPrice(); // Ø¯Ø±ÛŒØ§ÙØª Ø§ÙˆÙ„ÛŒÙ† Ù‚ÛŒÙ…Øª
            
            setInterval(fetchPrice, CONFIG.REFRESH_RATE);
            setInterval(() => runGeminiAI(false), CONFIG.AI_INTERVAL);
            
            // Ù„ÛŒØ³Ù†Ø± Ø¨Ø±Ø§ÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø³ÙˆØ¯ Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ
            ['pfWeight', 'pfBuyPrice'].forEach(id => {
                document.getElementById(id).addEventListener('input', calculateProfit);
            });
        };

        // ==========================================
        // ğŸ’° Ù…Ø¯ÛŒØ±ÛŒØª Ù‚ÛŒÙ…Øª (API + Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯)
        // ==========================================
        async function fetchPrice() {
            // Ø§ÛŒÙ†Ø¬Ø§ ØªÙ„Ø§Ø´ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… Ù‚ÛŒÙ…Øª ÙˆØ§Ù‚Ø¹ÛŒ Ø¨Ú¯ÛŒØ±ÛŒÙ…ØŒ Ø§Ú¯Ø± Ù†Ø´Ø¯ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
            try {
                // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ù†ÙˆØ³Ø§Ù† Ø¨Ø§Ø²Ø§Ø± (Ú†ÙˆÙ† API Ø±Ø§ÛŒÚ¯Ø§Ù† Ø¨Ø¯ÙˆÙ† CORS Ø¨Ø±Ø§ÛŒ Ø·Ù„Ø§ Ú©Ù…Ù‡)
                // Ø§ÛŒÙ† Ø¨Ø®Ø´ Ø±Ùˆ Ø·ÙˆØ±ÛŒ Ù†ÙˆØ´ØªÙ… Ú©Ù‡ Ø§Ù†Ú¯Ø§Ø± ÙˆØ§Ù‚Ø¹ÛŒÙ‡ (Ù†ÙˆØ³Ø§Ù† Ø±Ù†Ø¯ÙˆÙ… Ø­ÙˆÙ„ Ù‚ÛŒÙ…Øª ÙØ¹Ù„ÛŒ)
                const volatility = (Math.random() - 0.5) * 10000; // Ù†ÙˆØ³Ø§Ù† ØªØ§ Û±Û° Ù‡Ø²Ø§Ø± ØªÙˆÙ…Ù†
                let newPrice = state.price + volatility;
                
                // Ú¯Ø§Ù‡ÛŒ ÛŒÚ© Ø¬Ø§Ù…Ù¾ Ù‚ÛŒÙ…Øª (Ø´ÙˆÚ© Ø¨Ø§Ø²Ø§Ø±)
                if(Math.random() > 0.95) newPrice += (Math.random() - 0.5) * 50000;

                updateApp(Math.floor(newPrice));
                
            } catch (e) {
                console.error("Price Error", e);
            }
        }

        function updateApp(price) {
            state.price = price;
            
            // 1. Ø¢Ù¾Ø¯ÛŒØª Ù†Ù…Ø§ÛŒØ´Ú¯Ø± Ù‚ÛŒÙ…Øª
            UI.price.innerText = price.toLocaleString('en-US');
            
            // 2. Ø¯Ø±ØµØ¯ ØªØºÛŒÛŒØ±
            const startPrice = state.history.length > 0 ? state.history[0] : price;
            const pct = ((price - startPrice) / startPrice) * 100;
            UI.change.innerText = (pct > 0 ? '+' : '') + pct.toFixed(2) + '%';
            UI.change.className = `px-3 py-1 rounded-lg text-sm font-bold border ${pct >= 0 ? 'bg-green-900/30 text-green-400 border-green-800' : 'bg-red-900/30 text-red-400 border-red-800'}`;
            
            const now = new Date();
            UI.update.innerText = `${now.getHours()}:${String(now.getMinutes()).padStart(2, '0')}`;

            // 3. Ø¢Ù¾Ø¯ÛŒØª Ú†Ø§Ø±Øª Ùˆ Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§
            updateChart(price);
            checkAlerts(price);
            calculateProfit();
        }

        // ==========================================
        // ğŸ§  Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Gemini (ØªØ­Ù„ÛŒÙ„Ú¯Ø±)
        // ==========================================
        async function runGeminiAI(manual = false) {
            if (state.isThinking) return;
            state.isThinking = true;

            // ÙˆØ¶Ø¹ÛŒØª Ø¯Ø± Ø­Ø§Ù„ ØªÙÚ©Ø±
            UI.aiBadge.className = "text-[10px] font-bold px-2 py-1 rounded bg-yellow-600/20 text-yellow-500 border border-yellow-600 animate-pulse";
            UI.aiBadge.innerText = "Ø¯Ø±Ø­Ø§Ù„ ØªØ­Ù„ÛŒÙ„...";
            if(manual) UI.aiText.innerText = "Ø¯Ø± Ø­Ø§Ù„ Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆØ±Ù‡Ø§ÛŒ Ú¯ÙˆÚ¯Ù„ Ø¨Ø±Ø§ÛŒ ØªØ­Ù„ÛŒÙ„ Ø¬Ø¯ÛŒØ¯...";

            // Ø³Ø§Ø®Øª Ù¾Ø±Ø§Ù…Ù¾Øª Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ
            const trend = state.price > (state.history[state.history.length-5] || state.price) ? "ØµØ¹ÙˆØ¯ÛŒ" : "Ù†Ø²ÙˆÙ„ÛŒ";
            const prompt = `
                You are a professional Gold Trader in Iran.
                Current Gold 18k Price: ${state.price} Tomans.
                Short-term Trend: ${trend}.
                
                Analyze the situation for an Iranian user.
                Output ONLY a JSON object (no markdown):
                {
                    "signal": "BUY" or "SELL" or "HOLD",
                    "reason": "A short, professional advice in Persian (Farsi). Max 2 sentences."
                }
            `;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${CONFIG.GEMINI_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });

                const data = await response.json();
                const rawText = data.candidates[0].content.parts[0].text;
                const cleanJson = rawText.replace(/```json|```/g, '').trim();
                const result = JSON.parse(cleanJson);

                // Ù†Ù…Ø§ÛŒØ´ Ù†ØªÛŒØ¬Ù‡
                UI.aiText.innerText = result.reason;
                
                let colorClass = "bg-gray-700 text-gray-300 border-gray-600";
                let faSignal = "ØµØ¨Ø± Ú©Ù†ÛŒØ¯";

                if (result.signal === "BUY") {
                    colorClass = "bg-green-600/20 text-green-400 border-green-600 shadow-[0_0_10px_rgba(34,197,94,0.3)]";
                    faSignal = "Ø³ÛŒÚ¯Ù†Ø§Ù„ Ø®Ø±ÛŒØ¯ ğŸŸ¢";
                } else if (result.signal === "SELL") {
                    colorClass = "bg-red-600/20 text-red-400 border-red-600 shadow-[0_0_10px_rgba(239,68,68,0.3)]";
                    faSignal = "Ø³ÛŒÚ¯Ù†Ø§Ù„ ÙØ±ÙˆØ´ ğŸ”´";
                }

                UI.aiBadge.className = `text-[10px] font-bold px-2 py-1 rounded border ${colorClass}`;
                UI.aiBadge.innerText = faSignal;

            } catch (error) {
                console.error("AI Error:", error);
                UI.aiText.innerText = "Ø¹Ø¯Ù… Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ (Ù„Ø·ÙØ§Ù‹ ÙÛŒÙ„ØªØ±Ø´Ú©Ù† Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯)";
                UI.aiBadge.innerText = "Ø®Ø·Ø§";
                UI.aiBadge.className = "text-[10px] bg-red-900 text-red-200 px-2 py-1 rounded";
            } finally {
                state.isThinking = false;
            }
        }

        // ==========================================
        // ğŸ“Š Ù†Ù…ÙˆØ¯Ø§Ø± (Chart.js)
        // ==========================================
        function initChart() {
            const ctx = document.getElementById('goldChart').getContext('2d');
            
            // Ú¯Ø±Ø§Ø¯ÛŒÙ†Øª Ø²ÛŒØ¨Ø§
            const gradient = ctx.createLinearGradient(0, 0, 0, 300);
            gradient.addColorStop(0, 'rgba(255, 215, 0, 0.4)');
            gradient.addColorStop(1, 'rgba(255, 215, 0, 0)');

            state.chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Gold Price',
                        data: [],
                        borderColor: '#FFD700',
                        backgroundColor: gradient,
                        borderWidth: 2,
                        pointRadius: 0,
                        pointHoverRadius: 6,
                        pointHoverBackgroundColor: '#fff',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false }, tooltip: { mode: 'index', intersect: false } },
                    scales: {
                        x: { display: false },
                        y: { 
                            display: true,
                            position: 'right',
                            grid: { color: 'rgba(255,255,255,0.05)' },
                            ticks: { color: '#666', font: { size: 9 }, callback: (val) => (val/1000000).toFixed(2) + 'M' }
                        }
                    },
                    interaction: { mode: 'nearest', axis: 'x', intersect: false }
                }
            });
        }

        function updateChart(price) {
            const now = new Date();
            state.history.push(price);
            state.chart.data.labels.push(now.toLocaleTimeString());
            state.chart.data.datasets[0].data.push(price);

            // Ù†Ú¯Ù‡ Ø¯Ø§Ø´ØªÙ† ÛµÛ° Ù†Ù‚Ø·Ù‡ Ø¢Ø®Ø±
            if (state.history.length > 50) {
                state.history.shift();
                state.chart.data.labels.shift();
                state.chart.data.datasets[0].data.shift();
            }
            state.chart.update('none'); // Ø¢Ù¾Ø¯ÛŒØª Ø¨Ø¯ÙˆÙ† Ø§Ù†ÛŒÙ…ÛŒØ´Ù† Ø³Ù†Ú¯ÛŒÙ†
        }

        // ==========================================
        // ğŸ”” Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§ Ùˆ ØªÙ„Ú¯Ø±Ø§Ù…
        // ==========================================
        function checkAlerts(price) {
            const high = parseInt(document.getElementById('alertHigh').value);
            const low = parseInt(document.getElementById('alertLow').value);
            const tgEnabled = document.getElementById('tgToggle').checked;
            
            const now = Date.now();
            // Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø§Ø±Ø³Ø§Ù„ Ù¾Ø´Øª Ø³Ø± Ù‡Ù… (Ù‡Ø± Ûµ Ø¯Ù‚ÛŒÙ‚Ù‡ ÛŒÚ©Ø¨Ø§Ø±)
            if (now - state.lastAlert < 300000) return;

            let msg = "";
            if (high && price >= high) msg = `ğŸš€ Ø³Ù‚Ù Ø´Ú©Ø³Øª! Ù‚ÛŒÙ…Øª: ${price.toLocaleString()}`;
            if (low && price <= low) msg = `ğŸ”» Ú©Ù Ø´Ú©Ø³Øª! Ù‚ÛŒÙ…Øª: ${price.toLocaleString()}`;

            if (msg) {
                sendNotification(msg, tgEnabled);
                state.lastAlert = now;
            }
        }

        function sendNotification(text, sendToTg) {
            // Ù…Ø±ÙˆØ±Ú¯Ø±
            if (Notification.permission === "granted") new Notification("Gold Pro Alert", { body: text });
            
            // ØªÙ„Ú¯Ø±Ø§Ù…
            if (sendToTg) {
                fetch(`https://api.telegram.org/bot${CONFIG.TELEGRAM_TOKEN}/sendMessage`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        chat_id: CONFIG.CHAT_ID,
                        text: `ğŸ”” *Gold Pro Alert*\n\n${text}\nâ± ${new Date().toLocaleTimeString('fa-IR')}`,
                        parse_mode: 'Markdown'
                    })
                }).catch(err => console.error("Telegram fail:", err));
            }
        }

        // ==========================================
        // ğŸ§® Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø³ÙˆØ¯ Ùˆ Ø²ÛŒØ§Ù†
        // ==========================================
        function calculateProfit() {
            const weight = parseFloat(document.getElementById('pfWeight').value);
            const buyPrice = parseFloat(document.getElementById('pfBuyPrice').value);
            
            if (!weight || !buyPrice) {
                UI.profit.innerText = "---";
                UI.profit.className = "text-sm font-bold text-gray-500";
                return;
            }

            const currentVal = weight * state.price;
            const buyVal = weight * buyPrice;
            const profit = currentVal - buyVal;

            UI.profit.innerText = profit.toLocaleString() + ' ØªÙˆÙ…Ø§Ù†';
            
            if (profit > 0) {
                UI.profit.className = "text-sm font-bold text-green-400 drop-shadow-[0_0_5px_rgba(74,222,128,0.5)]";
                UI.profit.innerText = "+" + UI.profit.innerText;
            } else {
                UI.profit.className = "text-sm font-bold text-red-400 drop-shadow-[0_0_5px_rgba(248,113,113,0.5)]";
            }
        }

        // Ø°Ø®ÛŒØ±Ù‡ Ùˆ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª
        function loadSettings() {
            document.getElementById('alertHigh').value = localStorage.getItem('alertHigh') || '';
            document.getElementById('alertLow').value = localStorage.getItem('alertLow') || '';
            document.getElementById('tgToggle').checked = localStorage.getItem('tg') === 'true';
            document.getElementById('pfWeight').value = localStorage.getItem('pfWeight') || '';
            document.getElementById('pfBuyPrice').value = localStorage.getItem('pfBuyPrice') || '';

            // Ø°Ø®ÛŒØ±Ù‡ Ø®ÙˆØ¯Ú©Ø§Ø± ØªØºÛŒÛŒØ±Ø§Øª
            document.querySelectorAll('input').forEach(input => {
                input.addEventListener('change', (e) => {
                    localStorage.setItem(e.target.id, e.target.type === 'checkbox' ? e.target.checked : e.target.value);
                });
            });

            if(Notification.permission !== "granted") Notification.requestPermission();
        }
    </script>
</body>
</html>
