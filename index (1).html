<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø³ÛŒØ³ØªÙ… Ø¬Ø§Ù…Ø¹ Ù‚ÛŒÙ…Øª Ø·Ù„Ø§</title>
  <meta name="theme-color" content="#f59e0b">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/recharts@2.5.0/dist/Recharts.js"></script>
  <style>
    @font-face {
      font-family: 'Vazir';
      src: url('https://cdn.jsdelivr.net/gh/rastikerdar/vazir-font@v30.1.0/dist/Vazirmatn-Regular.woff2') format('woff2');
    }
    body {
      font-family: 'Vazir', sans-serif;
      margin: 0;
      padding: 0;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;
    const { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, Area, AreaChart } = Recharts;

    const GoldPriceTracker = () => {
      const [darkMode, setDarkMode] = useState(() => {
        const saved = localStorage.getItem('darkMode');
        return saved ? JSON.parse(saved) : false;
      });
      
      const [prices, setPrices] = useState({
        gold18k: 0,
        lastUpdate: new Date().toLocaleTimeString('fa-IR'),
        change: 0,
        changePercent: 0,
        high: 0,
        low: 0
      });
      
      const [loading, setLoading] = useState(false);
      const [showSettings, setShowSettings] = useState(false);
      const [history, setHistory] = useState(() => {
        const saved = localStorage.getItem('priceHistory');
        return saved ? JSON.parse(saved) : [];
      });
      
      const [aiAnalysis, setAiAnalysis] = useState('');
      const [analyzing, setAnalyzing] = useState(false);
      
      const [alerts, setAlerts] = useState(() => {
        const saved = localStorage.getItem('alerts');
        return saved ? JSON.parse(saved) : {
          priceAlert: '',
          priceAlertActive: false,
          percentAlert: '2',
          percentAlertActive: false,
          timeAlert: '60',
          timeAlertActive: false,
          lastAlertTime: null
        };
      });

      const [notifSettings, setNotifSettings] = useState(() => {
        const saved = localStorage.getItem('notifSettings');
        return saved ? JSON.parse(saved) : {
          pwa: true,
          telegram: true,
          email: true,
          telegramChatId: '',
          sound: 'default'
        };
      });

      const lastPriceRef = useRef(0);
      const telegramBotToken = '8427937062:AAGYnoVu_hEuanfGOM_EeMyX0aHBlsCBgYo';
      const userEmail = 'alialialiooo0921@gmail.com';

      useEffect(() => {
        localStorage.setItem('darkMode', JSON.stringify(darkMode));
      }, [darkMode]);

      useEffect(() => {
        localStorage.setItem('alerts', JSON.stringify(alerts));
      }, [alerts]);

      useEffect(() => {
        localStorage.setItem('notifSettings', JSON.stringify(notifSettings));
      }, [notifSettings]);

      useEffect(() => {
        localStorage.setItem('priceHistory', JSON.stringify(history));
      }, [history]);

      const fetchGoldPrice = async () => {
        setLoading(true);
        try {
          const response = await fetch('https://api.codebazan.ir/golds/');
          const data = await response.json();
          
          if (data && data.aram) {
            const currentPrice = parseInt(data.aram);
            const prevPrice = lastPriceRef.current || currentPrice;
            const change = currentPrice - prevPrice;
            const changePercent = prevPrice ? ((change / prevPrice) * 100).toFixed(2) : 0;
            
            setPrices(prev => ({
              gold18k: currentPrice,
              lastUpdate: new Date().toLocaleTimeString('fa-IR'),
              change: change,
              changePercent: changePercent,
              high: Math.max(prev.high || currentPrice, currentPrice),
              low: prev.low ? Math.min(prev.low, currentPrice) : currentPrice
            }));

            setHistory(prev => {
              const newHistory = [...prev, {
                price: currentPrice,
                time: new Date().toLocaleTimeString('fa-IR', { hour: '2-digit', minute: '2-digit' }),
                timestamp: Date.now()
              }];
              return newHistory.slice(-50);
            });

            if (prevPrice > 0) {
              checkAlerts(currentPrice, prevPrice);
            }
            
            lastPriceRef.current = currentPrice;
          }
        } catch (error) {
          console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù‚ÛŒÙ…Øª:', error);
        }
        setLoading(false);
      };

      const checkAlerts = (currentPrice, prevPrice) => {
        let alertMessage = '';

        if (alerts.priceAlertActive && alerts.priceAlert) {
          const targetPrice = parseInt(alerts.priceAlert);
          if (currentPrice >= targetPrice && prevPrice < targetPrice) {
            alertMessage = `ğŸ¯ Ù‚ÛŒÙ…Øª Ø¨Ù‡ ${formatPrice(targetPrice)} ØªÙˆÙ…Ø§Ù† Ø±Ø³ÛŒØ¯!\nÙ‚ÛŒÙ…Øª ÙØ¹Ù„ÛŒ: ${formatPrice(currentPrice)} ØªÙˆÙ…Ø§Ù†`;
          }
        }

        if (alerts.percentAlertActive && alerts.percentAlert && prevPrice > 0) {
          const percentChange = Math.abs(((currentPrice - prevPrice) / prevPrice) * 100);
          const targetPercent = parseFloat(alerts.percentAlert);
          if (percentChange >= targetPercent) {
            const direction = currentPrice > prevPrice ? 'Ø§ÙØ²Ø§ÛŒØ´' : 'Ú©Ø§Ù‡Ø´';
            alertMessage = `ğŸ“Š ${direction} ${percentChange.toFixed(2)}Ùª Ø¯Ø± Ù‚ÛŒÙ…Øª!\nÙ‚ÛŒÙ…Øª ÙØ¹Ù„ÛŒ: ${formatPrice(currentPrice)} ØªÙˆÙ…Ø§Ù†`;
          }
        }

        if (alerts.timeAlertActive && alerts.timeAlert) {
          const now = Date.now();
          const timeInterval = parseInt(alerts.timeAlert) * 60 * 1000;
          if (!alerts.lastAlertTime || (now - alerts.lastAlertTime) >= timeInterval) {
            alertMessage = `â° Ú¯Ø²Ø§Ø±Ø´ Ø¯ÙˆØ±Ù‡â€ŒØ§ÛŒ\nÙ‚ÛŒÙ…Øª ÙØ¹Ù„ÛŒ: ${formatPrice(currentPrice)} ØªÙˆÙ…Ø§Ù†\nØªØºÛŒÛŒØ±Ø§Øª: ${prices.changePercent}Ùª`;
            setAlerts(prev => ({ ...prev, lastAlertTime: now }));
          }
        }

        if (alertMessage) {
          sendNotifications(alertMessage);
        }
      };

      const sendNotifications = async (message) => {
        if (notifSettings.pwa && 'Notification' in window) {
          if (Notification.permission === 'granted') {
            new Notification('Ù‡Ø´Ø¯Ø§Ø± Ù‚ÛŒÙ…Øª Ø·Ù„Ø§ ğŸ’°', {
              body: message,
              icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y="75" font-size="75">ğŸ’°</text></svg>',
              badge: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y="75" font-size="75">ğŸ””</text></svg>',
              vibrate: [200, 100, 200]
            });
          } else if (Notification.permission !== 'denied') {
            const permission = await Notification.requestPermission();
            if (permission === 'granted') {
              new Notification('Ù‡Ø´Ø¯Ø§Ø± Ù‚ÛŒÙ…Øª Ø·Ù„Ø§ ğŸ’°', { body: message });
            }
          }
        }

        if (notifSettings.telegram && notifSettings.telegramChatId) {
          try {
            await fetch(`https://api.telegram.org/bot${telegramBotToken}/sendMessage`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                chat_id: notifSettings.telegramChatId,
                text: `ğŸ”” *Ù‡Ø´Ø¯Ø§Ø± Ù‚ÛŒÙ…Øª Ø·Ù„Ø§*\n\n${message}`,
                parse_mode: 'Markdown'
              })
            });
          } catch (error) {
            console.error('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ ØªÙ„Ú¯Ø±Ø§Ù…:', error);
          }
        }

        if (notifSettings.email) {
          console.log('ğŸ“§ Email notification:', message, 'to:', userEmail);
        }
      };

      const analyzeWithAI = async () => {
        if (history.length < 5) {
          setAiAnalysis('Ø¨Ø±Ø§ÛŒ ØªØ­Ù„ÛŒÙ„ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒØŒ Ø­Ø¯Ø§Ù‚Ù„ Ûµ Ù†Ù‚Ø·Ù‡ Ø¯Ø§Ø¯Ù‡ Ù†ÛŒØ§Ø² Ø§Ø³Øª. Ù„Ø·ÙØ§ Ú©Ù…ÛŒ ØµØ¨Ø± Ú©Ù†ÛŒØ¯ ØªØ§ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨ÛŒØ´ØªØ±ÛŒ Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ Ø´ÙˆØ¯.');
          return;
        }

        setAnalyzing(true);
        
        try {
          const priceData = history.slice(-20).map(h => h.price);
          const avgPrice = priceData.reduce((a, b) => a + b, 0) / priceData.length;
          const currentPrice = prices.gold18k;
          const trend = currentPrice > avgPrice ? 'ØµØ¹ÙˆØ¯ÛŒ' : 'Ù†Ø²ÙˆÙ„ÛŒ';
          const volatility = Math.max(...priceData) - Math.min(...priceData);
          const changeRate = ((currentPrice - priceData[0]) / priceData[0] * 100).toFixed(2);

          const prompt = `ØªØ­Ù„ÛŒÙ„ Ù‚ÛŒÙ…Øª Ø·Ù„Ø§ÛŒ Û±Û¸ Ø¹ÛŒØ§Ø±:
- Ù‚ÛŒÙ…Øª ÙØ¹Ù„ÛŒ: ${formatPrice(currentPrice)} ØªÙˆÙ…Ø§Ù†
- Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Û²Û° Ù†Ù‚Ø·Ù‡ Ø§Ø®ÛŒØ±: ${formatPrice(Math.round(avgPrice))} ØªÙˆÙ…Ø§Ù†
- Ø±ÙˆÙ†Ø¯: ${trend}
- Ù†ÙˆØ³Ø§Ù†: ${formatPrice(volatility)} ØªÙˆÙ…Ø§Ù†
- ØªØºÛŒÛŒØ±Ø§Øª: ${changeRate}Ùª

Ù„Ø·ÙØ§ ÛŒÚ© ØªØ­Ù„ÛŒÙ„ Ú©ÙˆØªØ§Ù‡ (Ø­Ø¯Ø§Ú©Ø«Ø± Û±Û°Û° Ú©Ù„Ù…Ù‡) Ø§Ø±Ø§Ø¦Ù‡ Ú©Ù† Ú©Ù‡ Ø´Ø§Ù…Ù„:
Û±. ÙˆØ¶Ø¹ÛŒØª ÙØ¹Ù„ÛŒ Ø¨Ø§Ø²Ø§Ø±
Û². Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ú©ÙˆØªØ§Ù‡â€ŒÙ…Ø¯Øª
Û³. Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø¹Ù…Ù„ÛŒ (Ø®Ø±ÛŒØ¯/ÙØ±ÙˆØ´/ØµØ¨Ø±)

ÙÙ‚Ø· Ù…ØªÙ† ÙØ§Ø±Ø³ÛŒ Ø¨Ø¯ÙˆÙ† ØªÙˆØ¶ÛŒØ­Ø§Øª Ø§Ø¶Ø§ÙÛŒ.`;

          const response = await fetch('https://api.anthropic.com/v1/messages', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'anthropic-version': '2023-06-01'
            },
            body: JSON.stringify({
              model: 'claude-sonnet-4-20250514',
              max_tokens: 1000,
              messages: [{ role: 'user', content: prompt }]
            })
          });

          const data = await response.json();
          const analysisText = data.content?.[0]?.text || 'ØªØ­Ù„ÛŒÙ„ Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ù†ÛŒØ³Øª';
          setAiAnalysis(analysisText);
          
        } catch (error) {
          console.error('Ø®Ø·Ø§ Ø¯Ø± ØªØ­Ù„ÛŒÙ„ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ:', error);
          
          const priceData = history.slice(-10).map(h => h.price);
          const avgPrice = priceData.reduce((a, b) => a + b, 0) / priceData.length;
          const currentPrice = prices.gold18k;
          
          let analysis = 'ğŸ“Š ØªØ­Ù„ÛŒÙ„ ØªÚ©Ù†ÛŒÚ©Ø§Ù„:\n\n';
          
          if (currentPrice > avgPrice * 1.02) {
            analysis += 'ğŸ”´ Ø¨Ø§Ø²Ø§Ø± Ø¯Ø± Ø±ÙˆÙ†Ø¯ ØµØ¹ÙˆØ¯ÛŒ Ù‚ÙˆÛŒ Ø§Ø³Øª. Ù‚ÛŒÙ…Øª Ø¨Ø§Ù„Ø§ØªØ± Ø§Ø² Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ù…ØªØ­Ø±Ú© Ù‚Ø±Ø§Ø± Ø¯Ø§Ø±Ø¯.\n\n';
            analysis += 'ğŸ’¡ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯: Ø¨Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯ Ù…Ù†ØªØ¸Ø± Ø§ØµÙ„Ø§Ø­ Ù‚ÛŒÙ…Øª Ø¨Ù…Ø§Ù†ÛŒØ¯. Ø¨Ø±Ø§ÛŒ ÙØ±ÙˆØ´ Ø²Ù…Ø§Ù† Ù…Ù†Ø§Ø³Ø¨ÛŒ Ø§Ø³Øª.';
          } else if (currentPrice < avgPrice * 0.98) {
            analysis += 'ğŸŸ¢ Ø¨Ø§Ø²Ø§Ø± Ø¯Ø± Ø±ÙˆÙ†Ø¯ Ù†Ø²ÙˆÙ„ÛŒ Ø§Ø³Øª. Ù‚ÛŒÙ…Øª Ù¾Ø§ÛŒÛŒÙ†â€ŒØªØ± Ø§Ø² Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ù…ØªØ­Ø±Ú© Ù‚Ø±Ø§Ø± Ø¯Ø§Ø±Ø¯.\n\n';
            analysis += 'ğŸ’¡ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯: ÙØ±ØµØª Ù…Ù†Ø§Ø³Ø¨ÛŒ Ø¨Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯. Ø¨Ø±Ø§ÛŒ ÙØ±ÙˆØ´ ØµØ¨Ø± Ú©Ù†ÛŒØ¯ ØªØ§ Ù‚ÛŒÙ…Øª Ø¨Ø§Ù„Ø§ Ø¨Ø±ÙˆØ¯.';
          } else {
            analysis += 'ğŸŸ¡ Ø¨Ø§Ø²Ø§Ø± Ø¯Ø± Ø­Ø§Ù„Øª Ø®Ù†Ø«ÛŒ Ùˆ Ø¨Ø¯ÙˆÙ† Ø±ÙˆÙ†Ø¯ Ù…Ø´Ø®Øµ Ø§Ø³Øª.\n\n';
            analysis += 'ğŸ’¡ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯: Ù…Ù†ØªØ¸Ø± Ø³ÛŒÚ¯Ù†Ø§Ù„â€ŒÙ‡Ø§ÛŒ Ù‚ÙˆÛŒâ€ŒØªØ± Ø¨Ù…Ø§Ù†ÛŒØ¯. Ù‡Ù…â€ŒØ§Ú©Ù†ÙˆÙ† Ø²Ù…Ø§Ù† Ù…Ù†Ø§Ø³Ø¨ÛŒ Ø¨Ø±Ø§ÛŒ Ù…Ø¹Ø§Ù…Ù„Ù‡ Ù†ÛŒØ³Øª.';
          }
          
          setAiAnalysis(analysis);
        }
        
        setAnalyzing(false);
      };

      const connectTelegram = async () => {
        const chatId = prompt('Ù„Ø·ÙØ§ Chat ID ØªÙ„Ú¯Ø±Ø§Ù… Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:\n\n(Ø¨Ø±Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØª Chat ID Ø¨Ù‡ Ø±Ø¨Ø§Øª @userinfobot Ù¾ÛŒØ§Ù… Ø¯Ù‡ÛŒØ¯)');
        if (chatId) {
          setNotifSettings(prev => ({ ...prev, telegramChatId: chatId }));
          
          try {
            const response = await fetch(`https://api.telegram.org/bot${telegramBotToken}/sendMessage`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                chat_id: chatId,
                text: 'âœ… Ø±Ø¨Ø§Øª Ù‚ÛŒÙ…Øª Ø·Ù„Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ù…ØªØµÙ„ Ø´Ø¯!\n\nØ´Ù…Ø§ Ø§Ø² Ø§ÛŒÙ† Ù¾Ø³ ØªÙ…Ø§Ù… Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§ Ø±Ø§ Ø¯Ø±ÛŒØ§ÙØª Ø®ÙˆØ§Ù‡ÛŒØ¯ Ú©Ø±Ø¯.'
              })
            });
            
            if (response.ok) {
              alert('âœ… Ø§ØªØµØ§Ù„ Ø¨Ù‡ ØªÙ„Ú¯Ø±Ø§Ù… Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯!');
            } else {
              alert('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§ØªØµØ§Ù„ Ø¨Ù‡ ØªÙ„Ú¯Ø±Ø§Ù…. Ù„Ø·ÙØ§ Chat ID Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯.');
            }
          } catch (error) {
            alert('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§ØªØµØ§Ù„ Ø¨Ù‡ ØªÙ„Ú¯Ø±Ø§Ù…. Ù„Ø·ÙØ§ Chat ID Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯.');
          }
        }
      };

      useEffect(() => {
        fetchGoldPrice();
        const interval = setInterval(fetchGoldPrice, 30000);
        return () => clearInterval(interval);
      }, []);

      useEffect(() => {
        if ('Notification' in window && Notification.permission === 'default') {
          Notification.requestPermission();
        }
      }, []);

      const formatPrice = (price) => price.toLocaleString('fa-IR');

      const chartData = history.map(h => ({
        time: h.time,
        price: h.price
      }));

      const Icon = ({ name, className = "w-5 h-5", spin = false }) => {
        const icons = {
          sun: <svg className={className} fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>,
          moon: <svg className={className} fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>,
          settings: <svg className={className} fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"/><path d="M12 1v6m0 6v6m5.66-13.66l-4.24 4.24m0 6.84l4.24 4.24M23 12h-6m-6 0H1m18.66 5.66l-4.24-4.24m0-6.84l4.24-4.24"/></svg>,
          refresh: <svg className={`${className} ${spin ? 'animate-spin' : ''}`} fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M23 4v6h-6M1 20v-6h6"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>,
          trendUp: <svg className={className} fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>,
          trendDown: <svg className={className} fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><polyline points="23 18 13.5 8.5 8.5 13.5 1 6"/><polyline points="17 18 23 18 23 12"/></svg>,
          x: <svg className={className} fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
          check: <svg className={className} fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>,
          brain: <svg className={`${className} ${spin ? 'animate-pulse' : ''}`} fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z"/><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z"/></svg>
        };
        return icons[name] || null;
      };

      return (
        <div className={`min-h-screen transition-colors duration-300 ${darkMode ? 'bg-gray-900' : 'bg-gradient-to-br from-amber-50 to-yellow-100'}`}>
          <div className="max-w-6xl mx-auto p-4">
            
            {/* Header */}
            <div className={`rounded-xl shadow-lg p-6 mb-6 ${darkMode ? 'bg-gray-800' : 'bg-white'}`}>
              <div className="flex items-center justify-between mb-4">
                <h1 className={`text-3xl font-bold ${darkMode ? 'text-amber-400' : 'text-amber-800'}`}>
                  ğŸ’° Ø³ÛŒØ³ØªÙ… Ø¬Ø§Ù…Ø¹ Ù‚ÛŒÙ…Øª Ø·Ù„Ø§
                </h1>
                <div className="flex gap-2">
                  <button
                    onClick={() => setDarkMode(!darkMode)}
                    className={`p-3 rounded-lg transition ${darkMode ? 'bg-gray-700 text-yellow-400 hover:bg-gray-600' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}`}
                  >
                    <Icon name={darkMode ? 'sun' : 'moon'} />
                  </button>
                  <button
                    onClick={() => setShowSettings(!showSettings)}
                    className={`p-3 rounded-lg transition ${darkMode ? 'bg-gray-700 text-blue-400 hover:bg-gray-600' : 'bg-blue-100 text-blue-600 hover:bg-blue-200'}`}
                  >
                    <Icon name="settings" />
                  </button>
                  <button
                    onClick={fetchGoldPrice}
                    disabled={loading}
                    className={`p-3 rounded-lg transition text-white disabled:opacity-50 ${darkMode ? 'bg-amber-600 hover:bg-amber-700' : 'bg-amber-600 hover:bg-amber-700'}`}
                  >
                    <Icon name="refresh" spin={loading} />
                  </button>
                </div>
              </div>

              {/* Main Price Display */}
              <div className={`text-center py-8 rounded-xl ${darkMode ? 'bg-gradient-to-r from-amber-900 to-yellow-900' : 'bg-gradient-to-r from-amber-100 to-yellow-100'}`}>
                <div className={`text-5xl font-bold mb-2 ${darkMode ? 'text-amber-300' : 'text-amber-900'}`}>
                  {formatPrice(prices.gold18k)} <span className="text-2xl">ØªÙˆÙ…Ø§Ù†</span>
                </div>
                <div className={`text-sm mt-2 ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>Ù‡Ø± Ú¯Ø±Ù… Ø·Ù„Ø§ÛŒ Û±Û¸ Ø¹ÛŒØ§Ø±</div>
                
                {prices.change !== 0 && (
                  <div className={`flex items-center justify-center gap-2 mt-4 text-lg font-semibold ${prices.change > 0 ? 'text-green-500' : 'text-red-500'}`}>
                    <Icon name={prices.change > 0 ? 'trendUp' : 'trendDown'} />
                    <span>{formatPrice(Math.abs(prices.change))} ØªÙˆÙ…Ø§Ù† ({prices.changePercent}%)</span>
                  </div>
                )}

                <div className={`flex justify-center gap-8 mt-4 text-sm ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>
                  <div>Ø¨ÛŒØ´ØªØ±ÛŒÙ†: <span className="font-bold">{formatPrice(prices.high)}</span></div>
                  <div>Ú©Ù…ØªØ±ÛŒÙ†: <span className="font-bold">{formatPrice(prices.low)}</span></div>
                </div>
              </div>

              <div className={`text-center text-sm mt-4 ${darkMode ? 'text-gray-500' : 'text-gray-500'}`}>
                Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ: {prices.lastUpdate}
              </div>
            </div>

            {/* Settings Panel */}
            {showSettings && (
              <div className={`rounded-xl shadow-lg p-6 mb-6 ${darkMode ? 'bg-gray-800' : 'bg-white'}`}>
                <div className="flex items-center justify-between mb-4">
                  <h2 className={`text-xl font-bold ${darkMode ? 'text-white' : 'text-gray-800'}`}>âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª</h2>
                  <button onClick={() => setShowSettings(false)} className="p-2">
                    <Icon name="x" className={`w-5 h-5 ${darkMode ? 'text-gray-400' : 'text-gray-600'}`} />
                  </button>
                </div>

                <div className="space-y-4">
                  <div>
                    <h3 className={`font-semibold mb-2 ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>ğŸ“¢ Ú©Ø§Ù†Ø§Ù„â€ŒÙ‡Ø§ÛŒ Ø§Ø·Ù„Ø§Ø¹â€ŒØ±Ø³Ø§Ù†ÛŒ</h3>
                    <div className="space-y-2">
                      <label className="flex items-center gap-2 cursor-pointer">
                        <input
                          type="checkbox"
                          checked={notifSettings.pwa}
                          onChange={(e) => setNotifSettings(prev => ({ ...prev, pwa: e.target.checked }))}
                          className="w-4 h-4"
                        />
                        <span className={darkMode ? 'text-gray-300' : 'text-gray-700'}>Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† PWA</span>
                      </label>
                      
                      <div className="flex items-center gap-2">
                        <input
                          type="checkbox"
                          checked={notifSettings.telegram}
                          onChange={(e) => setNotifSettings(prev => ({ ...prev, telegram: e.target.checked }))}
                          className="w-4 h-4"
                        />
                        <span className={darkMode ? 'text-gray-300' : 'text-gray-700'}>ØªÙ„Ú¯Ø±Ø§Ù…</span>
                        {!notifSettings.telegramChatId ? (
                          <button
                            onClick={connectTelegram}
                            className="text-xs bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600 transition"
                          >
                            Ø§ØªØµØ§Ù„
                          </button>
                        ) : (
                          <div className="flex items-center gap-1 text-xs text-green-500">
                            <Icon name="check" className="w-4 h-4" />
                            <span>Ù…ØªØµÙ„</span>
                          </div>
                        )}
                      </div>

                      <label className="flex items-center gap-2 cursor-pointer">
                        <input
                          type="checkbox"
                          checked={notifSettings.email}
                          onChange={(e) => setNotifSettings(prev => ({ ...prev, email: e.target.checked }))}
                          className="w-4 h-4"
                        />
                        <span className={`text-sm ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                          Ø§ÛŒÙ…ÛŒÙ„ ({userEmail})
                        </span>
                      </label>
                    </div>
                  </div>
                </div>
              </div>
            )}

            {/* Alerts */}
            <div className={`rounded-xl shadow-lg p-6 mb-6 ${darkMode ? 'bg-gray-800' : 'bg-white'}`}>
              <h2 className={`text-xl font-bold mb-4 ${darkMode ? 'text-white' : 'text-gray-800'}`}>ğŸ”” Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§</h2>
              
              <div className="space-y-4">
                {/* Price Alert */}
                <div>
                  <label className={`block mb-2 font-semibold ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                    Ù‡Ø´Ø¯Ø§Ø± Ù‚ÛŒÙ…Øª
                  </label>
                  <div className="flex gap-3">
                    <input
                      type="number"
                      placeholder="Ù‚ÛŒÙ…Øª Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± (ØªÙˆÙ…Ø§Ù†)"
                      value={alerts.priceAlert}
                      onChange={(e) => setAlerts(prev => ({ ...prev, priceAlert: e.target.value }))}
                      className={`flex-1 p-3 border-2 rounded-lg focus:outline-none ${
                        darkMode 
                          ? 'bg-gray-700 border-gray-600 text-white focus:border-amber-500' 
                          : 'bg-white border-gray-300 focus:border-amber-500'
                      }`}
                    />
                    <button
                      onClick={() => {
                        if (!alerts.priceAlert && !alerts.priceAlertActive) {
                          alert('Ù„Ø·ÙØ§ Ø§Ø¨ØªØ¯Ø§ Ù‚ÛŒÙ…Øª Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯');
                          return;
                        }
                        setAlerts(prev => ({ ...prev, priceAlertActive: !prev.priceAlertActive }));
                      }}
                      className={`px-6 py-3 rounded-lg font-semibold transition ${
                        alerts.priceAlertActive 
                          ? 'bg-green-600 text-white hover:bg-green-700' 
                          : 'bg-gray-400 text-white hover:bg-gray-500'
                      }`}
                    >
                      {alerts.priceAlertActive ? 'ÙØ¹Ø§Ù„' : 'ØºÛŒØ±ÙØ¹Ø§Ù„'}
                    </button>
                  </div>
                </div>

                {/* Percent Alert */}
                <div>
                  <label className={`block mb-2 font-semibold ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                    Ù‡Ø´Ø¯Ø§Ø± Ø¯Ø±ØµØ¯ ØªØºÛŒÛŒØ±Ø§Øª
                  </label>
                  <div className="flex gap-3">
                    <input
                      type="number"
                      placeholder="Ø¯Ø±ØµØ¯ ØªØºÛŒÛŒØ±Ø§Øª"
                      value={alerts.percentAlert}
                      onChange={(e) => setAlerts(prev => ({ ...prev, percentAlert: e.target.value }))}
                      className={`flex-1 p-3 border-2 rounded-lg focus:outline-none ${
                        darkMode 
                          ? 'bg-gray-700 border-gray-600 text-white focus:border-amber-500' 
                          : 'bg-white border-gray-300 focus:border-amber-500'
                      }`}
                    />
                    <button
                      onClick={() => setAlerts(prev => ({ ...prev, percentAlertActive: !prev.percentAlertActive }))}
                      className={`px-6 py-3 rounded-lg font-semibold transition ${
                        alerts.percentAlertActive 
                          ? 'bg-green-600 text-white hover:bg-green-700' 
                          : 'bg-gray-400 text-white hover:bg-gray-500'
                      }`}
                    >
                      {alerts.percentAlertActive ? 'ÙØ¹Ø§Ù„' : 'ØºÛŒØ±ÙØ¹Ø§Ù„'}
                    </button>
                  </div>
                </div>

                {/* Time Alert */}
                <div>
                  <label className={`block mb-2 font-semibold ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                    Ù‡Ø´Ø¯Ø§Ø± Ø²Ù…Ø§Ù†ÛŒ (Ø¯Ù‚ÛŒÙ‚Ù‡)
                  </label>
                  <div className="flex gap-3">
                    <input
                      type="number"
                      placeholder="ÙØ§ØµÙ„Ù‡ Ø²Ù…Ø§Ù†ÛŒ (Ø¯Ù‚ÛŒÙ‚Ù‡)"
                      value={alerts.timeAlert}
                      onChange={(e) => setAlerts(prev => ({ ...prev, timeAlert: e.target.value }))}
                      className={`flex-1 p-3 border-2 rounded-lg focus:outline-none ${
                        darkMode 
                          ? 'bg-gray-700 border-gray-600 text-white focus:border-amber-500' 
                          : 'bg-white border-gray-300 focus:border-amber-500'
                      }`}
                    />
                    <button
                      onClick={() => setAlerts(prev => ({ ...prev, timeAlertActive: !prev.timeAlertActive }))}
                      className={`px-6 py-3 rounded-lg font-semibold transition ${
                        alerts.timeAlertActive 
                          ? 'bg-green-600 text-white hover:bg-green-700' 
                          : 'bg-gray-400 text-white hover:bg-gray-500'
                      }`}
                    >
                      {alerts.timeAlertActive ? 'ÙØ¹Ø§Ù„' : 'ØºÛŒØ±ÙØ¹Ø§Ù„'}
                    </button>
                  </div>
                </div>
              </div>
            </div>

            {/* Chart */}
            {history.length > 0 && (
              <div className={`rounded-xl shadow-lg p-6 mb-6 ${darkMode ? 'bg-gray-800' : 'bg-white'}`}>
                <h2 className={`text-xl font-bold mb-4 ${darkMode ? 'text-white' : 'text-gray-800'}`}>ğŸ“ˆ Ù†Ù…ÙˆØ¯Ø§Ø± Ù‚ÛŒÙ…Øª</h2>
                <div className="h-64">
                  <ResponsiveContainer width="100%" height="100%">
                    <AreaChart data={chartData}>
                      <defs>
                        <linearGradient id="colorPrice" x1="0" y1="0" x2="0" y2="1">
                          <stop offset="5%" stopColor="#f59e0b" stopOpacity={0.8}/>
                          <stop offset="95%" stopColor="#f59e0b" stopOpacity={0}/>
                        </linearGradient>
                      </defs>
                      <CartesianGrid strokeDasharray="3 3" stroke={darkMode ? '#374151' : '#e5e7eb'} />
                      <XAxis 
                        dataKey="time" 
                        stroke={darkMode ? '#9ca3af' : '#6b7280'}
                        style={{ fontSize: '12px' }}
                      />
                      <YAxis 
                        stroke={darkMode ? '#9ca3af' : '#6b7280'}
                        style={{ fontSize: '12px' }}
                        tickFormatter={(value) => formatPrice(value)}
                      />
                      <Tooltip 
                        contentStyle={{
                          backgroundColor: darkMode ? '#1f2937' : '#ffffff',
                          border: `1px solid ${darkMode ? '#374151' : '#e5e7eb'}`,
                          borderRadius: '8px',
                          color: darkMode ? '#f3f4f6' : '#1f2937'
                        }}
                        formatter={(value) => [formatPrice(value) + ' ØªÙˆÙ…Ø§Ù†', 'Ù‚ÛŒÙ…Øª']}
                        labelStyle={{ color: darkMode ? '#f3f4f6' : '#1f2937' }}
                      />
                      <Area 
                        type="monotone" 
                        dataKey="price" 
                        stroke="#f59e0b" 
                        strokeWidth={2}
                        fillOpacity={1} 
                        fill="url(#colorPrice)" 
                      />
                    </AreaChart>
                  </ResponsiveContainer>
                </div>
              </div>
            )}

            {/* AI Analysis */}
            <div className={`rounded-xl shadow-lg p-6 ${darkMode ? 'bg-gray-800' : 'bg-white'}`}>
              <div className="flex items-center justify-between mb-4">
                <h2 className={`text-xl font-bold ${darkMode ? 'text-white' : 'text-gray-800'}`}>
                  ğŸ¤– ØªØ­Ù„ÛŒÙ„ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ
                </h2>
                <button
                  onClick={analyzeWithAI}
                  disabled={analyzing || history.length < 5}
                  className={`flex items-center gap-2 px-4 py-2 rounded-lg font-semibold transition disabled:opacity-50 ${
                    darkMode 
                      ? 'bg-purple-600 text-white hover:bg-purple-700' 
                      : 'bg-purple-600 text-white hover:bg-purple-700'
                  }`}
                >
                  <Icon name="brain" spin={analyzing} />
                  {analyzing ? 'Ø¯Ø± Ø­Ø§Ù„ ØªØ­Ù„ÛŒÙ„...' : 'ØªØ­Ù„ÛŒÙ„ Ú©Ù†'}
                </button>
              </div>

              {aiAnalysis ? (
                <div className={`p-4 rounded-lg whitespace-pre-line ${
                  darkMode ? 'bg-gray-700 text-gray-200' : 'bg-gray-50 text-gray-800'
                }`}>
                  {aiAnalysis}
                </div>
              ) : (
                <div className={`text-center py-8 ${darkMode ? 'text-gray-500' : 'text-gray-400'}`}>
                  {history.length < 5 
                    ? 'Ø¨Ø±Ø§ÛŒ ØªØ­Ù„ÛŒÙ„ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒØŒ Ø­Ø¯Ø§Ù‚Ù„ Ûµ Ù†Ù‚Ø·Ù‡ Ø¯Ø§Ø¯Ù‡ Ù†ÛŒØ§Ø² Ø§Ø³Øª'
                    : 'Ø¨Ø±Ø§ÛŒ Ù…Ø´Ø§Ù‡Ø¯Ù‡ ØªØ­Ù„ÛŒÙ„ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒØŒ Ø¯Ú©Ù…Ù‡ "ØªØ­Ù„ÛŒÙ„ Ú©Ù†" Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯'
                  }
                </div>
              )}
            </div>

          </div>
        </div>
      );
    };

    ReactDOM.render(<GoldPriceTracker />, document.getElementById('root'));
  </script>
</body>
</html>
