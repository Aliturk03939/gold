<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø³ÛŒØ³ØªÙ… Ø¬Ø§Ù…Ø¹ Ù‚ÛŒÙ…Øª Ø·Ù„Ø§</title>
  <meta name="theme-color" content="#f59e0b">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/recharts@2.5.0/dist/Recharts.js"></script>
  <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet">
  <style>
    body {
      font-family: 'Vazirmatn', sans-serif;
      margin: 0;
      padding: 0;
    }
    .price-change-positive {
      color: #10b981;
    }
    .price-change-negative {
      color: #ef4444;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;
    const { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, Area, AreaChart } = Recharts;

    const GoldPriceTracker = () => {
      const [darkMode, setDarkMode] = useState(() => {
        const saved = localStorage.getItem('darkMode');
        return saved ? JSON.parse(saved) : false;
      });
      
      const [prices, setPrices] = useState({
        gold18k: 2850000,
        lastUpdate: new Date().toLocaleTimeString('fa-IR'),
        change: 0,
        changePercent: 0,
        high: 2850000,
        low: 2850000
      });
      
      const [loading, setLoading] = useState(false);
      const [showSettings, setShowSettings] = useState(false);
      const [history, setHistory] = useState(() => {
        const saved = localStorage.getItem('priceHistory');
        if (saved) {
          return JSON.parse(saved);
        } else {
          // ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø§ÙˆÙ„ÛŒÙ‡ Ø¨Ø§ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ³Øª
          const initialHistory = [];
          const basePrice = 2800000;
          for (let i = 0; i < 10; i++) {
            const time = new Date(Date.now() - (10 - i) * 60000);
            initialHistory.push({
              price: basePrice + Math.round(Math.random() * 100000 - 50000),
              time: time.toLocaleTimeString('fa-IR', { hour: '2-digit', minute: '2-digit' }),
              timestamp: time.getTime()
            });
          }
          return initialHistory;
        }
      });
      
      const [aiAnalysis, setAiAnalysis] = useState('');
      const [analyzing, setAnalyzing] = useState(false);
      
      const [alerts, setAlerts] = useState(() => {
        const saved = localStorage.getItem('alerts');
        return saved ? JSON.parse(saved) : {
          priceAlert: '',
          priceAlertActive: false,
          percentAlert: '2',
          percentAlertActive: false,
          timeAlert: '60',
          timeAlertActive: false,
          lastAlertTime: null
        };
      });

      const [notifSettings, setNotifSettings] = useState(() => {
        const saved = localStorage.getItem('notifSettings');
        return saved ? JSON.parse(saved) : {
          pwa: true,
          sound: 'default'
        };
      });

      const lastPriceRef = useRef(2850000);

      // Ø°Ø®ÛŒØ±Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¯Ø± localStorage
      useEffect(() => {
        localStorage.setItem('darkMode', JSON.stringify(darkMode));
      }, [darkMode]);

      useEffect(() => {
        localStorage.setItem('alerts', JSON.stringify(alerts));
      }, [alerts]);

      useEffect(() => {
        localStorage.setItem('notifSettings', JSON.stringify(notifSettings));
      }, [notifSettings]);

      useEffect(() => {
        localStorage.setItem('priceHistory', JSON.stringify(history));
      }, [history]);

      // ØªØ§Ø¨Ø¹ Ø§ØµÙ„ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ù‚ÛŒÙ…Øª
      const fetchGoldPrice = async () => {
        setLoading(true);
        try {
          // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ù‚ÛŒÙ…Øª Ø§Ø² API
          await new Promise(resolve => setTimeout(resolve, 1000));
          
          // Ø§ÛŒØ¬Ø§Ø¯ ØªØºÛŒÛŒØ± ØªØµØ§Ø¯ÙÛŒ Ø¯Ø± Ù‚ÛŒÙ…Øª (Â±ÛµÙª)
          const basePrice = 2850000;
          const randomFactor = 0.95 + Math.random() * 0.1; // Û°Ù«Û¹Ûµ ØªØ§ Û±Ù«Û°Ûµ
          const currentPrice = Math.round(basePrice * randomFactor);
          
          const prevPrice = lastPriceRef.current || currentPrice;
          const change = currentPrice - prevPrice;
          const changePercent = prevPrice ? ((change / prevPrice) * 100).toFixed(2) : 0;
          
          setPrices(prev => ({
            gold18k: currentPrice,
            lastUpdate: new Date().toLocaleTimeString('fa-IR'),
            change: change,
            changePercent: changePercent,
            high: Math.max(prev.high || currentPrice, currentPrice),
            low: prev.low ? Math.min(prev.low, currentPrice) : currentPrice
          }));

          setHistory(prev => {
            const newHistory = [...prev, {
              price: currentPrice,
              time: new Date().toLocaleTimeString('fa-IR', { hour: '2-digit', minute: '2-digit' }),
              timestamp: Date.now()
            }];
            // Ù†Ú¯Ù‡ Ø¯Ø§Ø´ØªÙ† ÙÙ‚Ø· ÛµÛ° Ø±Ú©ÙˆØ±Ø¯ Ø¢Ø®Ø±
            return newHistory.slice(-50);
          });

          if (prevPrice > 0) {
            checkAlerts(currentPrice, prevPrice);
          }
          
          lastPriceRef.current = currentPrice;
          
        } catch (error) {
          console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù‚ÛŒÙ…Øª:', error);
          
          // Ø­Ø§Ù„Øª fallback
          const fallbackPrice = 2850000;
          const prevPrice = lastPriceRef.current || fallbackPrice;
          const change = fallbackPrice - prevPrice;
          const changePercent = prevPrice ? ((change / prevPrice) * 100).toFixed(2) : 0;
          
          setPrices(prev => ({
            gold18k: fallbackPrice,
            lastUpdate: new Date().toLocaleTimeString('fa-IR'),
            change: change,
            changePercent: changePercent,
            high: Math.max(prev.high || fallbackPrice, fallbackPrice),
            low: prev.low ? Math.min(prev.low, fallbackPrice) : fallbackPrice
          }));
        }
        setLoading(false);
      };

      // Ø¨Ø±Ø±Ø³ÛŒ Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§
      const checkAlerts = (currentPrice, prevPrice) => {
        let alertMessage = '';

        if (alerts.priceAlertActive && alerts.priceAlert) {
          const targetPrice = parseInt(alerts.priceAlert);
          if (currentPrice >= targetPrice && prevPrice < targetPrice) {
            alertMessage = `ğŸ¯ Ù‚ÛŒÙ…Øª Ø¨Ù‡ ${formatPrice(targetPrice)} ØªÙˆÙ…Ø§Ù† Ø±Ø³ÛŒØ¯!\nÙ‚ÛŒÙ…Øª ÙØ¹Ù„ÛŒ: ${formatPrice(currentPrice)} ØªÙˆÙ…Ø§Ù†`;
            sendNotification(alertMessage);
          }
        }

        if (alerts.percentAlertActive && alerts.percentAlert && prevPrice > 0) {
          const percentChange = Math.abs(((currentPrice - prevPrice) / prevPrice) * 100);
          const targetPercent = parseFloat(alerts.percentAlert);
          if (percentChange >= targetPercent) {
            const direction = currentPrice > prevPrice ? 'Ø§ÙØ²Ø§ÛŒØ´' : 'Ú©Ø§Ù‡Ø´';
            alertMessage = `ğŸ“Š ${direction} ${percentChange.toFixed(2)}Ùª Ø¯Ø± Ù‚ÛŒÙ…Øª!\nÙ‚ÛŒÙ…Øª ÙØ¹Ù„ÛŒ: ${formatPrice(currentPrice)} ØªÙˆÙ…Ø§Ù†`;
            sendNotification(alertMessage);
          }
        }

        if (alerts.timeAlertActive && alerts.timeAlert) {
          const now = Date.now();
          const timeInterval = parseInt(alerts.timeAlert) * 60 * 1000;
          if (!alerts.lastAlertTime || (now - alerts.lastAlertTime) >= timeInterval) {
            alertMessage = `â° Ú¯Ø²Ø§Ø±Ø´ Ø¯ÙˆØ±Ù‡â€ŒØ§ÛŒ\nÙ‚ÛŒÙ…Øª ÙØ¹Ù„ÛŒ: ${formatPrice(currentPrice)} ØªÙˆÙ…Ø§Ù†\nØªØºÛŒÛŒØ±Ø§Øª: ${prices.changePercent}Ùª`;
            setAlerts(prev => ({ ...prev, lastAlertTime: now }));
            sendNotification(alertMessage);
          }
        }
      };

      // Ø§Ø±Ø³Ø§Ù„ Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† Ù…Ø±ÙˆØ±Ú¯Ø±
      const sendNotification = async (message) => {
        if (notifSettings.pwa && 'Notification' in window && Notification.permission === 'granted') {
          new Notification('ğŸ’° Ù‡Ø´Ø¯Ø§Ø± Ù‚ÛŒÙ…Øª Ø·Ù„Ø§', {
            body: message,
            icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="45" fill="%23f59e0b"/></svg>',
            badge: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="45" fill="%23ef4444"/></svg>',
            vibrate: [200, 100, 200]
          });
        }
      };

      // ØªØ­Ù„ÛŒÙ„ ØªÚ©Ù†ÛŒÚ©Ø§Ù„ Ø³Ø§Ø¯Ù‡
      const analyzeWithAI = () => {
        if (history.length < 5) {
          setAiAnalysis('Ø¨Ø±Ø§ÛŒ ØªØ­Ù„ÛŒÙ„ØŒ Ø­Ø¯Ø§Ù‚Ù„ Ûµ Ù†Ù‚Ø·Ù‡ Ø¯Ø§Ø¯Ù‡ Ù†ÛŒØ§Ø² Ø§Ø³Øª. Ù„Ø·ÙØ§ Ú©Ù…ÛŒ ØµØ¨Ø± Ú©Ù†ÛŒØ¯.');
          return;
        }

        setAnalyzing(true);
        
        // ØªØ­Ù„ÛŒÙ„ Ø³Ø§Ø¯Ù‡ Ù…Ø­Ù„ÛŒ
        setTimeout(() => {
          const priceData = history.slice(-10).map(h => h.price);
          const avgPrice = priceData.reduce((a, b) => a + b, 0) / priceData.length;
          const currentPrice = prices.gold18k;
          const volatility = Math.max(...priceData) - Math.min(...priceData);
          const trend = currentPrice > avgPrice ? 'ØµØ¹ÙˆØ¯ÛŒ' : 'Ù†Ø²ÙˆÙ„ÛŒ';
          const strength = Math.abs((currentPrice - avgPrice) / avgPrice * 100);
          
          let analysis = 'ğŸ“Š ØªØ­Ù„ÛŒÙ„ ØªÚ©Ù†ÛŒÚ©Ø§Ù„ Ø³Ø§Ø¯Ù‡:\n\n';
          
          if (trend === 'ØµØ¹ÙˆØ¯ÛŒ') {
            if (strength > 5) {
              analysis += 'ğŸ”´ Ø±ÙˆÙ†Ø¯ ØµØ¹ÙˆØ¯ÛŒ Ù‚ÙˆÛŒ\n';
              analysis += 'ğŸ’¡ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯: Ø¨Ø±Ø§ÛŒ ÙØ±ÙˆØ´ Ù…Ù†Ø§Ø³Ø¨ Ø§Ø³Øª. Ù…Ù†ØªØ¸Ø± Ø§ØµÙ„Ø§Ø­ Ø¨Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯ Ø¨Ø§Ø´ÛŒØ¯.';
            } else {
              analysis += 'ğŸŸ  Ø±ÙˆÙ†Ø¯ ØµØ¹ÙˆØ¯ÛŒ Ù…Ù„Ø§ÛŒÙ…\n';
              analysis += 'ğŸ’¡ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯: Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¨Ø®Ø´ÛŒ Ø§Ø² Ø³Ù‡Ø§Ù… Ø±Ø§ Ø¨ÙØ±ÙˆØ´ÛŒØ¯.';
            }
          } else {
            if (strength > 5) {
              analysis += 'ğŸŸ¢ Ø±ÙˆÙ†Ø¯ Ù†Ø²ÙˆÙ„ÛŒ Ù‚ÙˆÛŒ\n';
              analysis += 'ğŸ’¡ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯: ÙØ±ØµØª Ø®Ø±ÛŒØ¯ Ù…Ù†Ø§Ø³Ø¨. Ø§Ø² ÙØ±ÙˆØ´ Ø®ÙˆØ¯Ø¯Ø§Ø±ÛŒ Ú©Ù†ÛŒØ¯.';
            } else {
              analysis += 'ğŸŸ¡ Ø±ÙˆÙ†Ø¯ Ù†Ø²ÙˆÙ„ÛŒ Ù…Ù„Ø§ÛŒÙ…\n';
              analysis += 'ğŸ’¡ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯: Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø®Ø±ÛŒØ¯Ù‡Ø§ÛŒ Ø¬Ø²Ø¦ÛŒ Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡ÛŒØ¯.';
            }
          }
          
          analysis += `\n\nğŸ“ˆ Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙÙ†ÛŒ:\n`;
          analysis += `â€¢ Ù‚ÛŒÙ…Øª ÙØ¹Ù„ÛŒ: ${formatPrice(currentPrice)} ØªÙˆÙ…Ø§Ù†\n`;
          analysis += `â€¢ Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Û±Û° Ø¯ÙˆØ±Ù‡: ${formatPrice(Math.round(avgPrice))} ØªÙˆÙ…Ø§Ù†\n`;
          analysis += `â€¢ Ù†ÙˆØ³Ø§Ù†: ${formatPrice(volatility)} ØªÙˆÙ…Ø§Ù†\n`;
          analysis += `â€¢ Ù‚Ø¯Ø±Øª Ø±ÙˆÙ†Ø¯: ${strength.toFixed(2)}Ùª`;
          
          setAiAnalysis(analysis);
          setAnalyzing(false);
        }, 1500);
      };

      // Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù…Ø¬ÙˆØ² Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù†
      const requestNotificationPermission = () => {
        if ('Notification' in window && Notification.permission === 'default') {
          Notification.requestPermission().then(permission => {
            if (permission === 'granted') {
              alert('âœ… Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† ÙØ¹Ø§Ù„ Ø´Ø¯!');
            }
          });
        }
      };

      // Ø´Ø±ÙˆØ¹ ØªØ§ÛŒÙ…Ø± Ùˆ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù…Ø¬ÙˆØ²
      useEffect(() => {
        fetchGoldPrice();
        const interval = setInterval(fetchGoldPrice, 30000);
        requestNotificationPermission();
        return () => clearInterval(interval);
      }, []);

      // ÙØ±Ù…Øª Ù‚ÛŒÙ…Øª
      const formatPrice = (price) => {
        return new Intl.NumberFormat('fa-IR').format(price);
      };

      // Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù†Ù…ÙˆØ¯Ø§Ø±
      const chartData = history.map(h => ({
        time: h.time,
        price: h.price
      }));

      // Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª Ø¢ÛŒÚ©ÙˆÙ†
      const Icon = ({ name, className = "w-5 h-5", spin = false }) => {
        const icons = {
          sun: 'â˜€ï¸',
          moon: 'ğŸŒ™',
          settings: 'âš™ï¸',
          refresh: 'ğŸ”„',
          trendUp: 'ğŸ“ˆ',
          trendDown: 'ğŸ“‰',
          x: 'âœ–ï¸',
          check: 'âœ…',
          brain: 'ğŸ§ ',
          bell: 'ğŸ””',
          chart: 'ğŸ“Š'
        };
        return <span className={`${className} ${spin ? 'animate-spin' : ''}`}>{icons[name]}</span>;
      };

      return (
        <div className={`min-h-screen transition-colors duration-300 ${darkMode ? 'bg-gray-900 text-white' : 'bg-gradient-to-br from-amber-50 to-yellow-100 text-gray-800'}`}>
          <div className="max-w-6xl mx-auto p-4">
            
            {/* Header */}
            <div className={`rounded-xl shadow-lg p-6 mb-6 ${darkMode ? 'bg-gray-800' : 'bg-white'}`}>
              <div className="flex items-center justify-between mb-4">
                <h1 className={`text-2xl md:text-3xl font-bold ${darkMode ? 'text-amber-400' : 'text-amber-800'}`}>
                  ğŸ’° Ø³ÛŒØ³ØªÙ… Ø±Ø¯ÛŒØ§Ø¨ÛŒ Ù‚ÛŒÙ…Øª Ø·Ù„Ø§
                </h1>
                <div className="flex gap-2">
                  <button
                    onClick={() => setDarkMode(!darkMode)}
                    className={`p-2 rounded-lg transition ${darkMode ? 'bg-gray-700 hover:bg-gray-600' : 'bg-gray-200 hover:bg-gray-300'}`}
                    title={darkMode ? 'Ø­Ø§Ù„Øª Ø±ÙˆØ´Ù†' : 'Ø­Ø§Ù„Øª ØªØ§Ø±ÛŒÚ©'}
                  >
                    <Icon name={darkMode ? 'sun' : 'moon'} className="w-6 h-6" />
                  </button>
                  <button
                    onClick={() => setShowSettings(!showSettings)}
                    className={`p-2 rounded-lg transition ${darkMode ? 'bg-gray-700 hover:bg-gray-600' : 'bg-gray-200 hover:bg-gray-300'}`}
                    title="ØªÙ†Ø¸ÛŒÙ…Ø§Øª"
                  >
                    <Icon name="settings" className="w-6 h-6" />
                  </button>
                  <button
                    onClick={fetchGoldPrice}
                    disabled={loading}
                    className={`p-2 rounded-lg transition ${darkMode ? 'bg-amber-600 hover:bg-amber-700' : 'bg-amber-600 hover:bg-amber-700'} text-white`}
                    title="Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù‚ÛŒÙ…Øª"
                  >
                    <Icon name="refresh" className="w-6 h-6" spin={loading} />
                  </button>
                </div>
              </div>

              {/* Main Price Display */}
              <div className={`text-center py-6 rounded-xl ${darkMode ? 'bg-gradient-to-r from-amber-900 to-yellow-900' : 'bg-gradient-to-r from-amber-100 to-yellow-100'}`}>
                <div className={`text-4xl md:text-5xl font-bold mb-2 ${darkMode ? 'text-amber-300' : 'text-amber-900'}`}>
                  {formatPrice(prices.gold18k)} <span className="text-xl md:text-2xl">ØªÙˆÙ…Ø§Ù†</span>
                </div>
                <div className={`text-sm mt-2 ${darkMode ? 'text-amber-200' : 'text-amber-800'}`}>Ù‡Ø± Ú¯Ø±Ù… Ø·Ù„Ø§ÛŒ Û±Û¸ Ø¹ÛŒØ§Ø±</div>
                
                {prices.change !== 0 && (
                  <div className={`flex items-center justify-center gap-2 mt-4 text-lg font-semibold ${prices.change > 0 ? 'price-change-positive' : 'price-change-negative'}`}>
                    <Icon name={prices.change > 0 ? 'trendUp' : 'trendDown'} className="w-5 h-5" />
                    <span>{prices.change > 0 ? '+' : ''}{formatPrice(prices.change)} ØªÙˆÙ…Ø§Ù† ({prices.changePercent}%)</span>
                  </div>
                )}

                <div className={`flex justify-center gap-6 md:gap-8 mt-4 text-sm ${darkMode ? 'text-amber-200' : 'text-amber-800'}`}>
                  <div>Ø¨ÛŒØ´ØªØ±ÛŒÙ†: <span className="font-bold">{formatPrice(prices.high)}</span></div>
                  <div>Ú©Ù…ØªØ±ÛŒÙ†: <span className="font-bold">{formatPrice(prices.low)}</span></div>
                </div>
              </div>

              <div className={`text-center text-sm mt-4 ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>
                Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ: {prices.lastUpdate}
                <br />
                <span className="text-xs">(Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± Ù‡Ø± Û³Û° Ø«Ø§Ù†ÛŒÙ‡)</span>
              </div>
            </div>

            {/* Settings Panel */}
            {showSettings && (
              <div className={`rounded-xl shadow-lg p-6 mb-6 ${darkMode ? 'bg-gray-800' : 'bg-white'}`}>
                <div className="flex items-center justify-between mb-4">
                  <h2 className={`text-xl font-bold ${darkMode ? 'text-white' : 'text-gray-800'}`}>âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª</h2>
                  <button onClick={() => setShowSettings(false)} className="p-2">
                    <Icon name="x" className={`w-5 h-5 ${darkMode ? 'text-gray-400' : 'text-gray-600'}`} />
                  </button>
                </div>

                <div className="space-y-4">
                  <div>
                    <h3 className={`font-semibold mb-2 ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>ğŸ“¢ Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù†</h3>
                    <div className="space-y-2">
                      <label className="flex items-center gap-2 cursor-pointer">
                        <input
                          type="checkbox"
                          checked={notifSettings.pwa}
                          onChange={(e) => setNotifSettings(prev => ({ ...prev, pwa: e.target.checked }))}
                          className="w-4 h-4"
                        />
                        <span className={darkMode ? 'text-gray-300' : 'text-gray-700'}>Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† Ù…Ø±ÙˆØ±Ú¯Ø±</span>
                      </label>
                      
                      {!notifSettings.pwa && (
                        <button
                          onClick={requestNotificationPermission}
                          className="text-sm bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600 transition"
                        >
                          ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù†
                        </button>
                      )}
                    </div>
                  </div>
                </div>
              </div>
            )}

            {/* Alerts */}
            <div className={`rounded-xl shadow-lg p-6 mb-6 ${darkMode ? 'bg-gray-800' : 'bg-white'}`}>
              <h2 className={`text-xl font-bold mb-4 ${darkMode ? 'text-white' : 'text-gray-800'}`}>ğŸ”” Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§</h2>
              
              <div className="space-y-4">
                {/* Price Alert */}
                <div>
                  <label className={`block mb-2 font-semibold ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                    Ù‡Ø´Ø¯Ø§Ø± Ù‚ÛŒÙ…Øª
                  </label>
                  <div className="flex flex-col md:flex-row gap-3">
                    <input
                      type="number"
                      placeholder="Ù‚ÛŒÙ…Øª Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± (ØªÙˆÙ…Ø§Ù†)"
                      value={alerts.priceAlert}
                      onChange={(e) => setAlerts(prev => ({ ...prev, priceAlert: e.target.value }))}
                      className={`flex-1 p-3 border-2 rounded-lg focus:outline-none ${
                        darkMode 
                          ? 'bg-gray-700 border-gray-600 text-white focus:border-amber-500' 
                          : 'bg-white border-gray-300 focus:border-amber-500'
                      }`}
                    />
                    <button
                      onClick={() => {
                        if (!alerts.priceAlert && !alerts.priceAlertActive) {
                          alert('Ù„Ø·ÙØ§ Ø§Ø¨ØªØ¯Ø§ Ù‚ÛŒÙ…Øª Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯');
                          return;
                        }
                        setAlerts(prev => ({ ...prev, priceAlertActive: !prev.priceAlertActive }));
                      }}
                      className={`px-6 py-3 rounded-lg font-semibold transition whitespace-nowrap ${
                        alerts.priceAlertActive 
                          ? 'bg-green-600 text-white hover:bg-green-700' 
                          : 'bg-gray-400 text-white hover:bg-gray-500'
                      }`}
                    >
                      {alerts.priceAlertActive ? 'ÙØ¹Ø§Ù„ âœ…' : 'ØºÛŒØ±ÙØ¹Ø§Ù„'}
                    </button>
                  </div>
                </div>

                {/* Percent Alert */}
                <div>
                  <label className={`block mb-2 font-semibold ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                    Ù‡Ø´Ø¯Ø§Ø± Ø¯Ø±ØµØ¯ ØªØºÛŒÛŒØ±Ø§Øª (Ù…Ø«Ù„Ø§: 2 Ø¨Ø±Ø§ÛŒ Û²Ùª)
                  </label>
                  <div className="flex flex-col md:flex-row gap-3">
                    <input
                      type="number"
                      step="0.1"
                      placeholder="Ø¯Ø±ØµØ¯ ØªØºÛŒÛŒØ±Ø§Øª"
                      value={alerts.percentAlert}
                      onChange={(e) => setAlerts(prev => ({ ...prev, percentAlert: e.target.value }))}
                      className={`flex-1 p-3 border-2 rounded-lg focus:outline-none ${
                        darkMode 
                          ? 'bg-gray-700 border-gray-600 text-white focus:border-amber-500' 
                          : 'bg-white border-gray-300 focus:border-amber-500'
                      }`}
                    />
                    <button
                      onClick={() => setAlerts(prev => ({ ...prev, percentAlertActive: !prev.percentAlertActive }))}
                      className={`px-6 py-3 rounded-lg font-semibold transition whitespace-nowrap ${
                        alerts.percentAlertActive 
                          ? 'bg-green-600 text-white hover:bg-green-700' 
                          : 'bg-gray-400 text-white hover:bg-gray-500'
                      }`}
                    >
                      {alerts.percentAlertActive ? 'ÙØ¹Ø§Ù„ âœ…' : 'ØºÛŒØ±ÙØ¹Ø§Ù„'}
                    </button>
                  </div>
                </div>

                {/* Time Alert */}
                <div>
                  <label className={`block mb-2 font-semibold ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                    Ù‡Ø´Ø¯Ø§Ø± Ø²Ù…Ø§Ù†ÛŒ (Ø¯Ù‚ÛŒÙ‚Ù‡)
                  </label>
                  <div className="flex flex-col md:flex-row gap-3">
                    <input
                      type="number"
                      placeholder="ÙØ§ØµÙ„Ù‡ Ø²Ù…Ø§Ù†ÛŒ (Ø¯Ù‚ÛŒÙ‚Ù‡)"
                      value={alerts.timeAlert}
                      onChange={(e) => setAlerts(prev => ({ ...prev, timeAlert: e.target.value }))}
                      className={`flex-1 p-3 border-2 rounded-lg focus:outline-none ${
                        darkMode 
                          ? 'bg-gray-700 border-gray-600 text-white focus:border-amber-500' 
                          : 'bg-white border-gray-300 focus:border-amber-500'
                      }`}
                    />
                    <button
                      onClick={() => setAlerts(prev => ({ ...prev, timeAlertActive: !prev.timeAlertActive }))}
                      className={`px-6 py-3 rounded-lg font-semibold transition whitespace-nowrap ${
                        alerts.timeAlertActive 
                          ? 'bg-green-600 text-white hover:bg-green-700' 
                          : 'bg-gray-400 text-white hover:bg-gray-500'
                      }`}
                    >
                      {alerts.timeAlertActive ? 'ÙØ¹Ø§Ù„ âœ…' : 'ØºÛŒØ±ÙØ¹Ø§Ù„'}
                    </button>
                  </div>
                </div>
              </div>
            </div>

            {/* Chart */}
            {history.length > 0 && (
              <div className={`rounded-xl shadow-lg p-6 mb-6 ${darkMode ? 'bg-gray-800' : 'bg-white'}`}>
                <h2 className={`text-xl font-bold mb-4 ${darkMode ? 'text-white' : 'text-gray-800'}`}>ğŸ“ˆ Ù†Ù…ÙˆØ¯Ø§Ø± Ù‚ÛŒÙ…Øª</h2>
                <div className="h-64">
                  <ResponsiveContainer width="100%" height="100%">
                    <AreaChart data={chartData}>
                      <defs>
                        <linearGradient id="colorPrice" x1="0" y1="0" x2="0" y2="1">
                          <stop offset="5%" stopColor="#f59e0b" stopOpacity={0.8}/>
                          <stop offset="95%" stopColor="#f59e0b" stopOpacity={0}/>
                        </linearGradient>
                      </defs>
                      <CartesianGrid strokeDasharray="3 3" stroke={darkMode ? '#374151' : '#e5e7eb'} />
                      <XAxis 
                        dataKey="time" 
                        stroke={darkMode ? '#9ca3af' : '#6b7280'}
                        style={{ fontSize: '12px' }}
                      />
                      <YAxis 
                        stroke={darkMode ? '#9ca3af' : '#6b7280'}
                        style={{ fontSize: '12px' }}
                        tickFormatter={(value) => formatPrice(value)}
                      />
                      <Tooltip 
                        contentStyle={{
                          backgroundColor: darkMode ? '#1f2937' : '#ffffff',
                          border: `1px solid ${darkMode ? '#374151' : '#e5e7eb'}`,
                          borderRadius: '8px',
                          color: darkMode ? '#f3f4f6' : '#1f2937',
                          fontFamily: 'Vazirmatn, sans-serif'
                        }}
                        formatter={(value) => [formatPrice(value) + ' ØªÙˆÙ…Ø§Ù†', 'Ù‚ÛŒÙ…Øª']}
                        labelStyle={{ 
                          color: darkMode ? '#f3f4f6' : '#1f2937',
                          fontFamily: 'Vazirmatn, sans-serif'
                        }}
                      />
                      <Area 
                        type="monotone" 
                        dataKey="price" 
                        stroke="#f59e0b" 
                        strokeWidth={2}
                        fillOpacity={1} 
                        fill="url(#colorPrice)" 
                      />
                    </AreaChart>
                  </ResponsiveContainer>
                </div>
              </div>
            )}

            {/* AI Analysis */}
            <div className={`rounded-xl shadow-lg p-6 ${darkMode ? 'bg-gray-800' : 'bg-white'}`}>
              <div className="flex flex-col md:flex-row md:items-center justify-between mb-4 gap-2">
                <h2 className={`text-xl font-bold ${darkMode ? 'text-white' : 'text-gray-800'}`}>
                  ğŸ¤– ØªØ­Ù„ÛŒÙ„ ØªÚ©Ù†ÛŒÚ©Ø§Ù„
                </h2>
                <button
                  onClick={analyzeWithAI}
                  disabled={analyzing || history.length < 5}
                  className={`flex items-center justify-center gap-2 px-4 py-2 rounded-lg font-semibold transition disabled:opacity-50 ${
                    darkMode 
                      ? 'bg-purple-600 text-white hover:bg-purple-700' 
                      : 'bg-purple-600 text-white hover:bg-purple-700'
                  }`}
                >
                  <Icon name="brain" spin={analyzing} />
                  {analyzing ? 'Ø¯Ø± Ø­Ø§Ù„ ØªØ­Ù„ÛŒÙ„...' : 'ØªØ­Ù„ÛŒÙ„ Ú©Ù†'}
                </button>
              </div>

              {aiAnalysis ? (
                <div className={`p-4 rounded-lg whitespace-pre-line ${
                  darkMode ? 'bg-gray-700 text-gray-200' : 'bg-gray-50 text-gray-800'
                }`}>
                  {aiAnalysis}
                </div>
              ) : (
                <div className={`text-center py-8 ${darkMode ? 'text-gray-500' : 'text-gray-400'}`}>
                  {history.length < 5 
                    ? 'Ø¨Ø±Ø§ÛŒ ØªØ­Ù„ÛŒÙ„ØŒ Ø­Ø¯Ø§Ù‚Ù„ Ûµ Ù†Ù‚Ø·Ù‡ Ø¯Ø§Ø¯Ù‡ Ù†ÛŒØ§Ø² Ø§Ø³Øª'
                    : 'Ø¨Ø±Ø§ÛŒ Ù…Ø´Ø§Ù‡Ø¯Ù‡ ØªØ­Ù„ÛŒÙ„ØŒ Ø¯Ú©Ù…Ù‡ "ØªØ­Ù„ÛŒÙ„ Ú©Ù†" Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯'
                  }
                </div>
              )}
            </div>

            {/* Footer */}
            <div className={`text-center py-4 mt-6 text-sm ${darkMode ? 'text-gray-500' : 'text-gray-600'}`}>
              <p>ğŸ’° Ø³ÛŒØ³ØªÙ… Ø±Ø¯ÛŒØ§Ø¨ÛŒ Ù‚ÛŒÙ…Øª Ø·Ù„Ø§ | Ù†Ø³Ø®Ù‡ Ø¢Ø²Ù…Ø§ÛŒØ´ÛŒ</p>
              <p className="mt-1 text-xs">Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯</p>
            </div>

          </div>
        </div>
      );
    };

    ReactDOM.render(<GoldPriceTracker />, document.getElementById('root'));
  </script>
</body>
</html>
